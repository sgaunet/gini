name: Exec testsuite

vars:
  testfile: "test2-{{.venom.timestamp}}.ini"

testcases:

- name: clean old test files
  steps:
  - type: exec
    script: cd {{.venom.testsuite.workdir}} && rm -f test2-*.ini || exit 0
    # info: "result.systemout is {{.result.systemout}}"
    assertions:
    - result.code ShouldEqual 0

- name: prepare file
  steps:
  - type: exec
    script: |
      cd {{.venom.testsuite.workdir}}
      cp test2.ini.ori {{.testfile}}
    # info: "result.systemout is {{.result.systemout}}"
    assertions:
    - result.code ShouldEqual 0
    - result.systemout ShouldBeBlank

- name: delete default section
  steps:
  - type: exec
    script: |
      cd {{.venom.testsuite.workdir}}/..
      go run . --i tests/{{.testfile}} delsection
    # info: "result.systemout is {{.result.systemout}}"
    assertions:
    - result.code ShouldEqual 0
    - result.systemout ShouldBeBlank

- name: delete section named section
  steps:
  - type: exec
    script: |
      cd {{.venom.testsuite.workdir}}/..
      go run . --i tests/{{.testfile}} delsection --s section
    # info: "result.systemout is {{.result.systemout}}"
    assertions:
    - result.code ShouldEqual 0
    - result.systemout ShouldBeBlank

- name: result file should be empty
  steps:
  - type: exec
    script: |
      cd {{.venom.testsuite.workdir}}
      cat {{.testfile}}
    # info: "result.systemout is {{.result.systemout}}"
    assertions:
    - result.code ShouldEqual 0
    - result.systemout ShouldBeBlank

- name: clean working file
  steps:
  - type: exec
    script: cd {{.venom.testsuite.workdir}} && rm -f {{.testfile}} || exit 0
    # info: "result.systemout is {{.result.systemout}}"
    assertions:
    - result.code ShouldEqual 0
